var Checkbox;Checkbox=function(){function Checkbox(options){this.options=options||{},this.checkboxes=options.checkboxes,this.uncheckRadio=options.uncheckRadio,this.allowedAnswers=options.allowedAnswers,this.uncheckRadio=this.uncheckRadio||!1,this.allowedAnswers=this.allowedAnswers||null,this.generateCheckboxes.call(this,!1)}return Checkbox.uncheckRadio=!1,Checkbox.prototype.checkedElms={},Checkbox.prototype.maximumCheckboxes=function(){null!==this.allowedAnswers&&(this.checkboxes.filter(":checked").length>=this.allowedAnswers?$(this.checkboxes.filter(":not(:checked)")).each(function(index,element){$(element).prop("disabled",!0).closest(".list-group-item").addClass("disabled")}.bind(this)):$(this.checkboxes).each(function(index,element){$(element).prop("disabled",!1).closest(".list-group-item").removeClass("disabled")}.bind(this)))},Checkbox.prototype.generateCheckboxes=function(){$(this.checkboxes).each(function(index,element){var elm,inner,other,outer;elm=$(element),outer=$("<div>",{"class":"outer-"+elm.attr("type")}),inner=$("<div>",{"class":"inner-"+elm.attr("type")}),elm.is(":checked")===!0&&(outer.addClass("checked"),elm.closest(".list-group-item").addClass("checked"),other=elm.closest(".list-group-item").children(".other"),other.length>0&&other.removeClass("hide"),this.checkedElms[$(elm).attr("name")]=$(elm)),outer.insertBefore(elm).append(inner),elm.click(this.checkboxChanged.bind({uncheckRadio:this.uncheckRadio,outer:outer,input:elm,scope:this})).addClass("hide").addClass("doValidate")}.bind(this)),this.checkboxChanged.call({uncheckRadio:this.uncheckRadio,scope:this,options:this.options},!1)},Checkbox.prototype.resetCheckboxes=function(){return this.checkedElms={}},Checkbox.prototype.checkboxChanged=function(){var elm,inputName,scope;return elm=$(this.input),inputName=elm.attr("name"),scope=this.scope,"radio"===elm.attr("type")&&this.uncheckRadio===!0&&inputName in scope.checkedElms&&scope.checkedElms[inputName].is(elm)===!0?(elm.closest(".list-group-item").removeClass("checked"),elm.prop("checked",!1).prev().removeClass("checked"),delete scope.checkedElms[inputName],elm.trigger("change"),void scope.maximumCheckboxes.call(scope,!1)):($('input[name="'+inputName+'"]').each(function(index,element){var elm2;elm2=$(element),elm2.is(":checked")===!0?(elm2.prev().addClass("checked"),elm2.closest(".list-group-item").addClass("checked")):(elm2.prev().removeClass("checked"),elm2.closest(".list-group-item").removeClass("checked")),scope.checkedElms[inputName]=$(elm)}),void scope.maximumCheckboxes.call(scope,!1))},Checkbox}();var Questionnaire;Questionnaire=function(){function Questionnaire(options){options=options||{},options.check=new Checkbox(options),options.scale=new ScaleTable(options),options.other=new Other(options),options.validation=new Validation(options),options.table=new Table(options),options.tabindex=new TabIndex(options),options.sortable=new SortableClass(options)}return Questionnaire}();var Other;Other=function(){function Other(options){this.options=options||{},this.options.other=this.options.other||!1,this.options.other.each(function(index,element){var elm,input,inputName;elm=$(element),input=elm.prev().find("input"),inputName=input.attr("name"),input.change(this.otherChanged.bind({input:input,container:elm,options:this.options})),$($('input[name="'+inputName+'"]')).each(function(ind,elm2){elm2=$(elm2),elm2.is(input)===!1&&elm2.change(this.otherChanged.bind({input:input,container:elm,options:this.options}))}.bind(this))}.bind(this))}return Other.prototype.otherChanged=function(){this.input.is(":checked")===!0?this.container.removeClass("hide"):(this.container.addClass("hide"),this.container.parents(".has-error").each(function(ind,elm){$(elm).removeClass("has-error")}.bind(this)),this.container.removeClass("has-error"),this.container.children(".help-block").each(function(ind,elm){return $(elm).css("display","none")}.bind(this)))},Other}();var ScaleTable;ScaleTable=function(){function ScaleTable(options){this.options=options||{},this.options.selectRequired=this.options.selectRequired||" -- Selecteer een optie --",this.scaleTable=options.scaleTable,$(this.scaleTable).each(function(index,element){var elm,headers,trs;elm=$(element),headers=elm.find("thead th:not(.title)"),trs=elm.find("tbody tr"),$(trs).each(function(trIndex,trElm){var sel,td,tr;options=$(trElm).find("td:not(.title) input"),$(trElm).addClass("input-row"),tr=$("<tr>",{"class":"select-row"}),td=$('<td colspan="'+(options.length+1)+'">'),sel=$("<select>"),tr.insertAfter($(trElm)),tr.append(td),td.append(sel),sel.append($("<option>",{text:this.options.selectRequired,value:""})).change(this.selectChanged.bind({select:sel,tr:$(trElm),options:this.options})),$(options).each(function(tdIndex,inputElm){var tmp;inputElm=$(inputElm),tmp=$("<option>",{html:$(headers[tdIndex]).text()||"",value:inputElm.val()||""}),inputElm.change(this.inputChanged.bind({select:sel,input:inputElm,tr:$(trElm)})),inputElm.on("inputChanged",this.inputChanged.bind({select:sel,input:inputElm,tr:$(trElm)})),sel.append(tmp)}.bind(this))}.bind(this))}.bind(this))}return ScaleTable.prototype.inputChanged=function(){this.select.val(0===this.tr.find(":checked").length?"":this.input.val())},ScaleTable.prototype.selectChanged=function(){var active,input;active=this.select.find(":selected"),input=this.tr.find("input[value='"+active.val()+"']"),""===active.val()?(this.tr.find("input:checked").prop("checked",!1),this.tr.find(".checked").removeClass("checked"),this.options.check.resetCheckboxes()):input.prop("checked",!0).prev().addClass("checked")},ScaleTable}();var SortableClass;SortableClass=function(){function SortableClass(options){var scope;this.options=options||{},scope=this,$("#"+this.list+" li").each(function(ind,elm){var div;elm=$(elm),div=$("<div>",{"class":"handle",html:'<i class="fa fa-arrows"></i>'}),elm.prepend(div).find("select").data("current-position",ind+1).change(function(){var currentListPosition,currentPosition,li,selectedPosition;selectedPosition=parseFloat($(this).find("option:selected").data("position")),currentPosition=selectedPosition-1,currentListPosition=parseFloat($(this).data("current-position")),li=$(this).closest("li"),0===currentPosition?$("#"+scope.list).prepend(li):currentListPosition>currentPosition?$("#"+scope.list+" li").eq(currentPosition).before(li):$("#"+scope.list+" li").eq(currentPosition).after(li),scope.updateOrder.call(scope),scope.showOrder.call(scope,$(this).closest("li"))})}),null!=document.getElementById(this.list)&&(this.sortableInstance=new Sortable(document.getElementById(this.list),{handle:".handle",onEnd:function(evt){scope.updateOrder.call(scope),scope.showOrder.call(scope,$(evt.item))}})),scope.initOrder.call(scope),scope.updateOrder.call(scope),scope.showOrder.call(scope,$(this).closest("li"))}return SortableClass.prototype.list="sortable-list",SortableClass.prototype.initOrder=function(){var positions;positions=[],$("#"+this.list+" li").each(function(ind,elm){var selects;selects=$(elm).find('option[selected="selected"]'),$(selects).each(function(ind,elm){var curPosition;if(curPosition=$(elm).data("position"),null!=positions[curPosition])throw new Error("Order module position conflict: "+curPosition+" is selected twice.");return positions[curPosition]=elm}.bind(this))}.bind(this)),$(positions).each(function(ind,elm){return $("#"+this.list).append($(elm).closest("li"))}.bind(this))},SortableClass.prototype.showOrder=function(elm){var orginalCss;orginalCss=elm.css("backgroundColor"),elm.css("backgroundColor","#fffbdf"),setTimeout(function(){return elm.attr("style","")},1200)},SortableClass.prototype.updateOrder=function(){$("#"+this.list+" li").each(function(ind,elm){var indx,selects;selects=$(elm).find("select"),selects.length>0&&(indx=ind+1,$(selects).data("current-position",indx).find('option[data-position="'+indx+'"]').prop("selected","selected"))}.bind(this))},SortableClass}();var TabIndex;TabIndex=function(){function TabIndex(options){this.options=options||{},this.form=options.form||this.form||!1,this.form.find("input, button[data-type='next']").each(function(index,element){return $(element).attr("tabindex",index+1).on("focus",function(){return"radio"===$(this).attr("type")||"checkbox"===$(this).attr("type")?$(this).closest(".list-group-item").addClass("focused"):void 0}).on("blur",function(){return"radio"===$(this).attr("type")||"checkbox"===$(this).attr("type")?$(this).closest(".list-group-item").removeClass("focused"):void 0})}.bind(this))}return TabIndex.prototype.form=$("#questionnaireForm"),TabIndex}();var Table;Table=function(){function Table(){var num;num=0,$('table[data-type="scale"] tbody tr.input-row').each(function(trIndex,trElm){var className,elm;elm=$(trElm),className=0===num?"odd":"even",elm.hasClass("input-row")&&(elm.addClass(className),elm.next().hasClass("select-row")&&elm.next().addClass(className)),num=0===num?1:0}.bind(this))}return Table}();var Validation;Validation=function(){function Validation(options){var bootstrap;this.options=options||{},this.form=options.form||this.form||!1,this.allowedAnswers=options.allowedAnswers||this.allowedAnswers||null,bootstrap=this.bootstrap,this.addCustomMethods(),this.setCustomMessages(),this.validation=this.form.validate({errorElement:bootstrap.errorElement,errorClass:bootstrap.errorElementClass,ignore:":hidden:not(.doValidate), .noValidation",highlight:function(element){element=$(element),element.closest(bootstrap.input).addClass(bootstrap.errorClass),element.parents('table[data-type="scale"]').length>0?element.closest("tr").addClass(bootstrap.errorClass).next().addClass(bootstrap.errorClass):"checkbox"===element.attr("type")||"radio"===element.attr("type")?element.closest(bootstrap.radioGroup).addClass(bootstrap.errorClass):element.closest(bootstrap.questionGroup).addClass(bootstrap.errorClass)},unhighlight:function(element){element=$(element),element.closest(bootstrap.input).removeClass(bootstrap.errorClass),element.parents('table[data-type="scale"]').length>0?element.closest("tr").removeClass(bootstrap.errorClass).next().removeClass(bootstrap.errorClass):"checkbox"===element.attr("type")||"radio"===element.attr("type")?element.closest(bootstrap.radioGroup).removeClass(bootstrap.errorClass):element.closest(bootstrap.questionGroup).removeClass(bootstrap.errorClass)},submitHandler:function(form){form.submit()},errorPlacement:function(error,element){"scale"===element.data("questionnaire-type")?element.closest("tr").children(".title").append(error):"checkbox"===element.attr("type")||"radio"===element.attr("type")?(element.closest(bootstrap.radioGroup).parent().prepend(error),error.attr("class",error.attr("class")+" checkboxes-check")):error.insertAfter(element.parent(bootstrap.inputGroup).length?element.parent():element)}}),$("#sonata_user_registration_form_plainPassword_first").length&&$("#sonata_user_registration_form_plainPassword_second").length&&$("#sonata_user_registration_form_plainPassword_second").rules("add",{equalTo:"#sonata_user_registration_form_plainPassword_first"}),null!==this.allowedAnswers&&this.allowedAnswers>1&&$(this.form.selector+" .checkbox input").each(function(index,element){$(element).rules("add",{require_from_group:[this.allowedAnswers,".checkbox input"]})}.bind(this))}return Validation.prototype.form=$("#questionnaireForm"),Validation.prototype.bootstrap={input:".form-group",inputContainer:".input",inputGroup:".input-group",radioGroup:".list-group",questionGroup:".list-group-item",panelGroup:".panel",panelGroupErrorClass:"panel-danger",errorClass:"has-error",errorElement:"span",errorElementClass:"help-block",radioErrorText:"Selecteer één van de verplichten opties.",checkboxErrorText:"Selecteer minimaal één optie.",scaleErrorText:"Selecteer één van de verplichten opties.",errorRequireFromGroup:"U dient tenminste {0} velden in te vullen."},Validation.prototype.setCustomMessages=function(){var bootstrap;bootstrap=this.bootstrap,$('input[type="radio"]').each(function(index,element){$(element).data("msg-required",bootstrap.radioErrorText)}.bind(this)),$('input[type="checkbox"]').each(function(index,element){$(element).data("msg-required",bootstrap.checkboxErrorText)}.bind(this)),$('table[data-type="scale"]').each(function(index,element){$(element).find("input").each(function(ind,elm){$(elm).data("questionnaire-type","scale").data("msg-required",bootstrap.scaleErrorText)}.bind(this))}.bind(this))},Validation.prototype.addCustomMethods=function(){var bootstrap;bootstrap=this.bootstrap,jQuery.validator.addMethod("require_from_group",function(value,element,options){var $fields,$fieldsFirst,isValid,validator,_ref;return $fields=$(options[1],element.form),$fieldsFirst=$fields.eq(0),validator=null!=(_ref=$fieldsFirst.data("valid_req_grp"))?_ref:$.extend({},this),isValid=$fields.filter(function(){return $(this).is(":checked")}).length>=options[0],$fieldsFirst.data("valid_req_grp",validator),$(element).data("being_validated")||($fields.data("being_validated",!0),$fields.each(function(){validator.element(this)}),$fields.data("being_validated",!1)),isValid},jQuery.validator.format(bootstrap.errorRequireFromGroup))},Validation}(),+function($){"use strict";var Collapse=function(element,options){this.$element=$(element),this.options=$.extend({},Collapse.DEFAULTS,options),this.transitioning=null,this.options.parent&&(this.$parent=$(this.options.parent)),this.options.toggle&&this.toggle()};Collapse.DEFAULTS={toggle:!0},Collapse.prototype.dimension=function(){var hasWidth=this.$element.hasClass("width");return hasWidth?"width":"height"},Collapse.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var startEvent=$.Event("show.bs.collapse");if(this.$element.trigger(startEvent),!startEvent.isDefaultPrevented()){var actives=this.$parent&&this.$parent.find("> .panel > .in");if(actives&&actives.length){var hasData=actives.data("bs.collapse");if(hasData&&hasData.transitioning)return;actives.collapse("hide"),hasData||actives.data("bs.collapse",null)}var dimension=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[dimension](0),this.transitioning=1;var complete=function(){this.$element.removeClass("collapsing").addClass("collapse in")[dimension]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!$.support.transition)return complete.call(this);var scrollSize=$.camelCase(["scroll",dimension].join("-"));this.$element.one($.support.transition.end,$.proxy(complete,this)).emulateTransitionEnd(350)[dimension](this.$element[0][scrollSize])}}},Collapse.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var startEvent=$.Event("hide.bs.collapse");if(this.$element.trigger(startEvent),!startEvent.isDefaultPrevented()){var dimension=this.dimension();this.$element[dimension](this.$element[dimension]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var complete=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return $.support.transition?void this.$element[dimension](0).one($.support.transition.end,$.proxy(complete,this)).emulateTransitionEnd(350):complete.call(this)}}},Collapse.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var old=$.fn.collapse;$.fn.collapse=function(option){return this.each(function(){var $this=$(this),data=$this.data("bs.collapse"),options=$.extend({},Collapse.DEFAULTS,$this.data(),"object"==typeof option&&option);!data&&options.toggle&&"show"==option&&(option=!option),data||$this.data("bs.collapse",data=new Collapse(this,options)),"string"==typeof option&&data[option]()})},$.fn.collapse.Constructor=Collapse,$.fn.collapse.noConflict=function(){return $.fn.collapse=old,this},$(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(e){var href,$this=$(this),target=$this.attr("data-target")||e.preventDefault()||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,""),$target=$(target),data=$target.data("bs.collapse"),option=data?"toggle":$this.data(),parent=$this.attr("data-parent"),$parent=parent&&$(parent);data&&data.transitioning||($parent&&$parent.find('[data-toggle=collapse][data-parent="'+parent+'"]').not($this).addClass("collapsed"),$this[$target.hasClass("in")?"addClass":"removeClass"]("collapsed")),$target.collapse(option)})}(jQuery),+function($){"use strict";var dismiss='[data-dismiss="alert"]',Alert=function(el){$(el).on("click",dismiss,this.close)};Alert.prototype.close=function(e){function removeElement(){$parent.trigger("closed.bs.alert").remove()}var $this=$(this),selector=$this.attr("data-target");selector||(selector=$this.attr("href"),selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,""));var $parent=$(selector);e&&e.preventDefault(),$parent.length||($parent=$this.hasClass("alert")?$this:$this.parent()),$parent.trigger(e=$.Event("close.bs.alert")),e.isDefaultPrevented()||($parent.removeClass("in"),$.support.transition&&$parent.hasClass("fade")?$parent.one($.support.transition.end,removeElement).emulateTransitionEnd(150):removeElement())};var old=$.fn.alert;$.fn.alert=function(option){return this.each(function(){var $this=$(this),data=$this.data("bs.alert");data||$this.data("bs.alert",data=new Alert(this)),"string"==typeof option&&data[option].call($this)})},$.fn.alert.Constructor=Alert,$.fn.alert.noConflict=function(){return $.fn.alert=old,this},$(document).on("click.bs.alert.data-api",dismiss,Alert.prototype.close)}(jQuery),+function($){"use strict";var Tab=function(element){this.element=$(element)};Tab.prototype.show=function(){var $this=this.element,$ul=$this.closest("ul:not(.dropdown-menu)"),selector=$this.data("target");if(selector||(selector=$this.attr("href"),selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")),!$this.parent("li").hasClass("active")){var previous=$ul.find(".active:last a")[0],e=$.Event("show.bs.tab",{relatedTarget:previous});if($this.trigger(e),!e.isDefaultPrevented()){var $target=$(selector);this.activate($this.parent("li"),$ul),this.activate($target,$target.parent(),function(){$this.trigger({type:"shown.bs.tab",relatedTarget:previous})})}}},Tab.prototype.activate=function(element,container,callback){function next(){$active.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),element.addClass("active"),transition?(element[0].offsetWidth,element.addClass("in")):element.removeClass("fade"),element.parent(".dropdown-menu")&&element.closest("li.dropdown").addClass("active"),callback&&callback()}var $active=container.find("> .active"),transition=callback&&$.support.transition&&$active.hasClass("fade");transition?$active.one($.support.transition.end,next).emulateTransitionEnd(150):next(),$active.removeClass("in")};var old=$.fn.tab;$.fn.tab=function(option){return this.each(function(){var $this=$(this),data=$this.data("bs.tab");data||$this.data("bs.tab",data=new Tab(this)),"string"==typeof option&&data[option]()})},$.fn.tab.Constructor=Tab,$.fn.tab.noConflict=function(){return $.fn.tab=old,this},$(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault(),$(this).tab("show")})}(jQuery),function(factory){"use strict";"function"==typeof define&&define.amd?define(factory):"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=factory():window.Sortable=factory()}(function(){"use strict";function Sortable(el,options){this.el=el,this.options=options=options||{},options.group=options.group||Math.random(),options.handle=options.handle||null,options.draggable=options.draggable||el.children[0]&&el.children[0].nodeName||(/[uo]l/i.test(el.nodeName)?"li":"*"),options.ghostClass=options.ghostClass||"sortable-ghost",options.ignore=options.ignore||"a, img",options.onAdd=_bind(this,options.onAdd||noop),options.onUpdate=_bind(this,options.onUpdate||noop),options.onRemove=_bind(this,options.onRemove||noop),options.onStart=_bind(this,options.onStart||noop),options.onEnd=_bind(this,options.onEnd||noop),el[expando]=options.group;for(var fn in this)"_"===fn.charAt(0)&&(this[fn]=_bind(this,this[fn]));void 0!==window.onpointerdown?(pointerdown="pointerdown",pointerup="pointerup",pointermove="pointermove",pointercancel="pointercancel"):(pointerdown="MSPointerDown",pointerup="MSPointerUp",pointermove="MSPointerMove",pointercancel="MSPointerCancel"),_on(el,"add",options.onAdd),_on(el,"update",options.onUpdate),_on(el,"remove",options.onRemove),_on(el,"start",options.onStart),_on(el,"stop",options.onEnd),_on(el,"mousedown",this._onTapStart),_on(el,"touchstart",this._onTapStart),supportIEdnd&&_on(el,"selectstart",this._onTapStart),_on(el,"dragover",this._onDragOver),_on(el,"dragenter",this._onDragOver),_on(el,pointerdown,this._onTapStart),_css(el,"touch-action","none"),_css(el,"-ms-touch-action","none"),touchDragOverListeners.push(this._onDragOver)}function _bind(ctx,fn){var args=slice.call(arguments,2);return fn.bind?fn.bind.apply(fn,[ctx].concat(args)):function(){return fn.apply(ctx,args.concat(slice.call(arguments)))}}function _closest(el,selector,ctx){if("*"===selector)return el;if(el){ctx=ctx||document,selector=selector.split(".");var tag=selector.shift().toUpperCase(),re=new RegExp("\\s("+selector.join("|")+")\\s","g");do if(!(""!==tag&&el.nodeName!=tag||selector.length&&((" "+el.className+" ").match(re)||[]).length!=selector.length))return el;while(el!==ctx&&(el=el.parentNode))}return null}function _globalDragOver(evt){evt.dataTransfer.dropEffect="move",evt.preventDefault()}function _on(el,event,fn){el.addEventListener(event,fn,!1)}function _off(el,event,fn){el.removeEventListener(event,fn,!1)}function _toggleClass(el,name,state){if(el)if(el.classList)el.classList[state?"add":"remove"](name);else{var className=(" "+el.className+" ").replace(/\s+/g," ").replace(" "+name+" ","");el.className=className+(state?" "+name:"")}}function _css(el,prop,val){if(el&&el.style){if(void 0===val)return document.defaultView&&document.defaultView.getComputedStyle?val=document.defaultView.getComputedStyle(el,""):el.currentStyle&&(val=el.currentStyle),void 0===prop?val:val[prop];el.style[prop]=val+("string"==typeof val?"":"px")}}function _find(ctx,tagName,iterator){if(ctx){var list=ctx.getElementsByTagName(tagName),i=0,n=list.length;if(iterator)for(;n>i;i++)iterator(list[i],i);return list}return[]}function _disableDraggable(el){return el.draggable=!1}function _unsilent(){_silent=!1}function _ghostInBottom(el,evt){var last=el.lastElementChild.getBoundingClientRect();return evt.clientY-(last.top+last.height)>5}var dragEl,ghostEl,rootEl,nextEl,lastEl,lastCSS,lastRect,activeGroup,tapEvt,touchEvt,pointerdown,pointerup,pointermove,pointercancel,expando="Sortable"+(new Date).getTime(),win=window,document=win.document,parseInt=win.parseInt,supportIEdnd=!!document.createElement("div").dragDrop,_silent=!1,_createEvent=function(event,item){var evt=document.createEvent("Event");return evt.initEvent(event,!0,!0),evt.item=item,evt},noop=function(){},slice=[].slice,touchDragOverListeners=[];return Sortable.prototype={constructor:Sortable,_applyEffects:function(){_toggleClass(dragEl,this.options.ghostClass,!0)},_onTapStart:function(evt){var touch=evt.touches&&evt.touches[0],target=(touch||evt).target,options=this.options,el=this.el;if(options.handle&&(target=_closest(target,options.handle,el)),target=_closest(target,options.draggable,el),target&&"selectstart"==evt.type&&"A"!=target.tagName&&"IMG"!=target.tagName&&target.dragDrop(),target&&!dragEl&&target.parentNode===el){tapEvt=evt,target.draggable=!0,Array.prototype.forEach.call(options.ignore.split(","),function(criteria){_find(target,criteria.trim(),_disableDraggable)}),touch&&(tapEvt={target:target,clientX:touch.clientX,clientY:touch.clientY},this._onDragStart(tapEvt,!0),evt.preventDefault()),("pointerdown"==evt.type||"MSPointerDown"==evt.type)&&(this._onDragStart(tapEvt,!0),evt.preventDefault()),_on(this.el,"dragstart",this._onDragStart),_on(this.el,"dragend",this._onDrop),_on(document,"dragover",_globalDragOver);try{document.selection?document.selection.empty():window.getSelection().removeAllRanges()}catch(err){}}},_emulateDragOver:function(){if(touchEvt){_css(ghostEl,"display","none");var target=document.elementFromPoint(touchEvt.clientX,touchEvt.clientY),parent=target,group=this.options.group,i=touchDragOverListeners.length;if(parent)do{if(parent[expando]===group){for(;i--;)touchDragOverListeners[i]({clientX:touchEvt.clientX,clientY:touchEvt.clientY,target:target,rootEl:parent});break}target=parent}while(parent=parent.parentNode);_css(ghostEl,"display","")}},_onTouchMove:function(evt){if(tapEvt){var touch=evt.touches[0],dx=touch.clientX-tapEvt.clientX,dy=touch.clientY-tapEvt.clientY;touchEvt=touch,_css(ghostEl,"webkitTransform","translate3d("+dx+"px,"+dy+"px,0)"),_css(ghostEl,"mozTransform","translate3d("+dx+"px,"+dy+"px,0)"),_css(ghostEl,"msTransform","translate3d("+dx+"px,"+dy+"px,0)"),_css(ghostEl,"transform","translate3d("+dx+"px,"+dy+"px,0)"),evt.preventDefault()}},_onDragStart:function(evt,isTouch){var target=evt.target,dataTransfer=evt.dataTransfer;if(rootEl=this.el,dragEl=target,nextEl=target.nextSibling,activeGroup=this.options.group,isTouch){var ghostRect,rect=target.getBoundingClientRect(),css=_css(target);ghostEl=target.cloneNode(!0),_css(ghostEl,"top",rect.top-parseInt(css.marginTop,10)),_css(ghostEl,"left",rect.left-parseInt(css.marginLeft,10)),_css(ghostEl,"width",rect.width),_css(ghostEl,"height",rect.height),_css(ghostEl,"opacity","0.8"),_css(ghostEl,"position","fixed"),_css(ghostEl,"zIndex","100000"),rootEl.appendChild(ghostEl),ghostRect=ghostEl.getBoundingClientRect(),_css(ghostEl,"width",2*rect.width-ghostRect.width),_css(ghostEl,"height",2*rect.height-ghostRect.height),_on(document,"touchmove",this._onTouchMove),_on(document,"touchend",this._onDrop),_on(document,"touchcancel",this._onDrop),_on(document,pointermove,this._onTouchMove),_on(document,pointerup,this._onDrop),_on(document,pointercancel,this._onDrop),this._loopId=setInterval(this._emulateDragOver,150)}else dataTransfer.effectAllowed="move",dataTransfer.setData("Text",target.textContent),_on(document,"drop",this._onDrop);dragEl.dispatchEvent(_createEvent("start",dragEl)),setTimeout(this._applyEffects)},_onDragOver:function(evt){if(!_silent&&activeGroup===this.options.group&&(void 0===evt.rootEl||evt.rootEl===this.el)){var el=this.el,target=_closest(evt.target,this.options.draggable,el);if(0===el.children.length||el.children[0]===ghostEl||el===evt.target&&_ghostInBottom(el,evt))el.appendChild(dragEl);else if(target&&target!==dragEl&&void 0!==target.parentNode[expando]){lastEl!==target&&(lastEl=target,lastCSS=_css(target),lastRect=target.getBoundingClientRect());var after,rect=lastRect,width=rect.right-rect.left,height=rect.bottom-rect.top,floating=/left|right|inline/.test(lastCSS.cssFloat+lastCSS.display),skew=(floating?(evt.clientX-rect.left)/width:(evt.clientY-rect.top)/height)>.5,isWide=target.offsetWidth>dragEl.offsetWidth,isLong=target.offsetHeight>dragEl.offsetHeight,nextSibling=target.nextSibling;_silent=!0,setTimeout(_unsilent,30),after=floating?target.previousElementSibling===dragEl&&!isWide||skew>.5&&isWide:target.nextElementSibling!==dragEl&&!isLong||skew>.5&&isLong,after&&!nextSibling?el.appendChild(dragEl):target.parentNode.insertBefore(dragEl,after?nextSibling:target)}}},_onDrop:function(evt){clearInterval(this._loopId),_off(document,"drop",this._onDrop),_off(document,"dragover",_globalDragOver),_off(this.el,"dragend",this._onDrop),_off(this.el,"dragstart",this._onDragStart),_off(this.el,"selectstart",this._onTapStart),_off(document,"touchmove",this._onTouchMove),_off(document,"touchend",this._onDrop),_off(document,"touchcancel",this._onDrop),_off(document,pointermove,this._onTouchMove),_off(document,pointerup,this._onDrop),_off(document,pointercancel,this._onDrop),evt&&(evt.preventDefault(),evt.stopPropagation(),ghostEl&&ghostEl.parentNode.removeChild(ghostEl),dragEl&&(_disableDraggable(dragEl),_toggleClass(dragEl,this.options.ghostClass,!1),rootEl.contains(dragEl)?dragEl.nextSibling!==nextEl&&dragEl.dispatchEvent(_createEvent("update",dragEl)):(rootEl.dispatchEvent(_createEvent("remove",dragEl)),dragEl.dispatchEvent(_createEvent("add",dragEl))),dragEl.dispatchEvent(_createEvent("stop",dragEl))),rootEl=dragEl=ghostEl=nextEl=tapEvt=touchEvt=lastEl=lastCSS=activeGroup=null)},destroy:function(){var el=this.el,options=this.options;_off(el,"add",options.onAdd),_off(el,"update",options.onUpdate),_off(el,"remove",options.onRemove),_off(el,"start",options.onStart),_off(el,"stop",options.onEnd),_off(el,"mousedown",this._onTapStart),_off(el,"touchstart",this._onTapStart),_off(el,"selectstart",this._onTapStart),_off(el,pointerdown,this._onTapStart),_off(el,"dragover",this._onDragOver),_off(el,"dragenter",this._onDragOver),Array.prototype.forEach.call(el.querySelectorAll("[draggable]"),function(el){el.removeAttribute("draggable")}),touchDragOverListeners.splice(touchDragOverListeners.indexOf(this._onDragOver),1),this._onDrop(),this.el=null}},Sortable.utils={on:_on,off:_off,css:_css,find:_find,bind:_bind,closest:_closest,toggleClass:_toggleClass},Sortable.version="0.3.0",Sortable});